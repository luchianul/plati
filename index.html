<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Management PlƒÉ»õi | Gabriel</title>
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;700&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        :root { 
    /* Am definit noul gradient: pleacƒÉ de jos (bottom) cu mov »ôi urcƒÉ spre alb */
    --bg-gradient: linear-gradient(to top, #a29bfe 0%, #f8faff 100%);
    --primary-vibrant: #5865f2; 
    --text-main: #2d3436;
    --mint: #00d2d3;
    --accent-purple: #6c5ce7;
}

        .frost-panel {
            background: rgba(255, 255, 255, 0.45);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.07);
        }

        body { 
    margin: 0; 
    font-family: 'Inter', sans-serif; 
    /* Folosim noul gradient */
    background: var(--bg-gradient); 
    /* FixƒÉm fundalul pentru a nu se repeta c√¢nd dai scroll pe mobil */
    background-attachment: fixed;
    min-height: 100vh;
    display: flex; 
    flex-direction: column; 
    align-items: center; 
    color: var(--text-main); 
    padding: 15px; 
    box-sizing: border-box;
}

        .main-wrapper { width: 100%; max-width: 450px; }

        /* Header adaptiv mobil */
        .mike-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 20px; width: 100%;
        }
        .welcome-text { font-size: 13px; font-weight: 700; color: rgba(0,0,0,0.5); }

        .brand-card-header { 
            padding: 20px; border-radius: 30px; text-align: center; margin-bottom: 20px;
        }
        
        .app-icon-dynamic {
            width: 55px; height: 55px; background: white; border-radius: 18px;
            display: flex; justify-content: center; align-items: center;
            font-size: 28px; font-weight: 900; color: var(--primary-vibrant);
            margin: 0 auto 10px auto; box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            text-transform: uppercase;
        }

        /* Formular Add corectat pentru ecrane mici */
        .add-slim { display: flex; gap: 8px; margin-bottom: 25px; width: 100%; }
        .add-slim input { 
            background: white; border: none; padding: 12px; 
            border-radius: 15px; font-size: 14px; outline: none; min-width: 0;
        }
        #newFactura { flex: 2; }
        #newSuma { flex: 1; }
        .add-slim button { 
            background: var(--primary-vibrant); color: white; border: none; 
            width: 50px; height: 50px; border-radius: 15px; font-size: 22px; 
            flex-shrink: 0; cursor: pointer;
        }

        /* Carduri facturi compacte */
        .item-card { 
            padding: 12px; border-radius: 20px; margin-bottom: 10px; 
            display: grid; grid-template-columns: auto 1fr 65px 75px; 
            align-items: center; gap: 8px; 
        }

        .controls { display: flex; gap: 4px; }
        .btn-ctrl { 
            background: white; border: 1px solid rgba(0,0,0,0.05); 
            width: 30px; height: 30px; border-radius: 8px; 
            display: flex; align-items: center; justify-content: center; font-size: 13px;
        }
        .item-name-text { font-weight: 700; font-size: 13px; line-height: 1.2; word-break: break-word; }

        .summary-pan { border-radius: 25px; padding: 18px; margin-top: 20px; }
        .score-num { font-weight: 900; font-size: 26px; color: #2d3436; letter-spacing: -1px; }

        .btn-sync { 
            width: 100%; padding: 16px; margin-top: 15px; 
            background: rgba(88, 101, 242, 0.6); backdrop-filter: blur(10px); 
            border: 1px solid rgba(255, 255, 255, 0.2); color: white; 
            border-radius: 18px; font-weight: 800; text-transform: uppercase; 
        }
        
    .btn-reset {
    margin-top: 40px;
    background: rgba(255, 255, 255, 0.2);
    border: 1px solid #ff7675 !important;
    color: #ff7675;
    font-size: 10px;
    font-weight: 800;
    text-transform: uppercase;
    
    /* MODIFICƒÇRILE DE LUNGIME AICI: */
    width: auto;            /* Nu mai ocupƒÉ tot r√¢ndul */
    min-width: 150px;       /* O lungime minimƒÉ ca sƒÉ arate bine */
    padding: 8px 20px;      /* Mai pu»õin √Ænalt (8px), dar cu spa»õiu lateral (20px) */
    display: block;         /* Permite centrarea */
    margin-left: auto;      /* Centrare st√¢nga */
    margin-right: auto;     /* Centrare dreapta */
    
    border-radius: 10px;
    cursor: pointer;
    opacity: 0.7;
}
}

.btn-reset:hover {
    background: rgba(255, 118, 117, 0.1);
    opacity: 1;
}

        h3 { font-size: 10px; text-transform: uppercase; color: #7f8c8d; margin: 15px 0 8px 5px; letter-spacing: 1px; }
        .btn-pay { width: 100%; padding: 10px 0; border-radius: 10px; border: none; font-size: 10px; font-weight: 800; }
        .unpaid { background: white; color: #b2bec3; border: 1px solid #eee; }
        .paid { background: var(--primary-vibrant); color: white; }
        
        .nav-icon { cursor: pointer; padding: 5px; }
		#totalFill { 
    background: #2d3436 !important; /* Culoarea barei de progres */
}
    </style>
</head>
<body>

<div class="main-wrapper">
    <div class="mike-header">
        <span class="welcome-text" id="welcomeUser">Welcome back, Gabriel!</span>
        <div style="font-size: 18px; display: flex; gap: 10px;">
            <span class="nav-icon" onclick="Swal.fire('Profil','Salut, Gabriel!','info')">üë§</span>
            <span class="nav-icon" onclick="schimbaNume()">‚öôÔ∏è</span>
        </div>
    </div>

    <div class="brand-card-header frost-panel">
        <div class="app-icon-dynamic" id="dynamicLetter">G</div>
        <h1 style="margin:0; font-size: 22px; font-weight: 800;">Management PlƒÉ»õi</h1>
        <div style="font-family:'Caveat'; color:var(--accent-purple); font-size:18px;">by VerTech</div>
        <div id="headerMonth" style="font-size:10px; font-weight:800; text-transform:uppercase; margin-top:10px; color:var(--mint); border: 1px solid var(--mint); display: inline-block; padding: 3px 10px; border-radius: 8px;">--</div>
    </div>

    <div class="add-slim">
        <input type="text" id="newFactura" placeholder="Nume...">
        <input type="number" id="newSuma" placeholder="‚Ç¨">
        <button id="addBtn" onclick="adaugaFactura()">+</button>
    </div>

    <div id="mainContent">
        <h3>De achitat acum</h3>
        <div id="containerNeplatite"></div>
        <h3>Istoric LunƒÉ</h3>
        <div id="containerPlatite"></div>
    </div>

    <div class="summary-pan frost-panel">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <span style="font-size:10px; font-weight:800; opacity:0.5;">TOTAL ACHITAT</span>
            <div style="text-align:right;">
                <div id="totalSumaPlatita" class="score-num">0.00 ‚Ç¨</div>
                <div style="height:4px; background:rgba(0,0,0,0.05); border-radius:2px; margin-top:5px; width: 80px; overflow:hidden; margin-left: auto;">
                    <div id="totalFill" style="height:100%; background:#d4e157; width:0%; transition: 0.5s;"></div>
                </div>
            </div>
        </div>
    </div>

    <button class="btn-sync" onclick="trimiteDate()">SincronizeazƒÉ √Æn Cloud</button>
    <button class="btn-reset" onclick="resetareLocala()">Resetare Memorie</button>
</div>

<script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbzEW785lu1Wzwyr8v8dehrQBbpQJt-1ahGURPKZtosCFjla7RbRu-6cuctIIo2wmkI9RA/exec";
    let facturi = [];
    let editIndex = -1;

    function schimbaNume() {
        Swal.fire({
            title: 'Personalizare',
            input: 'text',
            inputPlaceholder: 'Introdu numele tƒÉu',
            inputValue: localStorage.getItem("userName") || "Gabriel",
            confirmButtonColor: '#5865f2',
            confirmButtonText: 'SalveazƒÉ',
            background: 'rgba(255,255,255,0.9)',
            backdrop: 'blur(10px)'
        }).then((result) => {
            if (result.value) {
                const nume = result.value.trim();
                localStorage.setItem("userName", nume);
                actualizeazaInterfataNume(nume);
            }
        });
    }

    function actualizeazaInterfataNume(nume) {
        if(!nume) return;
        document.getElementById('welcomeUser').innerText = `Welcome back, ${nume}!`;
        document.getElementById('dynamicLetter').innerText = nume.charAt(0).toUpperCase();
    }

    async function incarcaDate() {
        Swal.fire({ title: 'Sincronizare...', didOpen: () => Swal.showLoading(), background: 'rgba(255,255,255,0.8)', backdrop: 'blur(10px)' });
        actualizeazaInterfataNume(localStorage.getItem("userName") || "Gabriel");
        try {
            const r = await fetch(scriptURL + "?t=" + new Date().getTime());
            const data = await r.json();
            facturi = Array.isArray(data) ? data : [];
            render();
            Swal.close();
        } catch (e) {
            facturi = JSON.parse(localStorage.getItem("facturi_gabriel_final")) || [];
            render();
            Swal.fire({ icon: 'info', title: 'Mod Local', timer: 1000, showConfirmButton: false });
        }
    }

    function render() {
        const ne = document.getElementById("containerNeplatite"), pl = document.getElementById("containerPlatite");
        ne.innerHTML = ""; pl.innerHTML = "";
        let total = 0;
        facturi.forEach((f, i) => {
            const h = `
                <div class="item-card frost-panel">
                    <div class="controls">
                        <div class="btn-ctrl" onclick="sterge(${i})" style="color:#ff7675">‚úï</div>
                        <div class="btn-ctrl" onclick="pregatesteEditare(${i})" style="color:#fab1a0">‚úèÔ∏è</div>
                    </div>
                    <div class="item-name-text">${f.nume}</div>
                    <div style="background:rgba(255,255,255,0.6); border-radius:8px; padding:4px; text-align:center; font-weight:800; font-size:12px;">${f.suma}‚Ç¨</div>
                    <button class="btn-pay ${f.status?'paid':'unpaid'}" onclick="toggle(${i})">${f.status?'‚úì OK':'ACHITƒÇ'}</button>
                </div>`;
            if(!f.status) ne.innerHTML += h;
            else { pl.innerHTML += h; total += parseFloat(f.suma) || 0; }
        });
        document.getElementById("totalSumaPlatita").innerText = total.toFixed(2) + " ‚Ç¨";
        document.getElementById("totalFill").style.width = Math.min((total/2000)*100, 100) + "%";
        localStorage.setItem("facturi_gabriel_final", JSON.stringify(facturi));
    }

    function adaugaFactura() {
        const n = document.getElementById("newFactura"), s = document.getElementById("newSuma");
        if(!n.value.trim()) return;
        if(editIndex > -1) { facturi[editIndex].nume = n.value; facturi[editIndex].suma = parseFloat(s.value) || 0; editIndex = -1; document.getElementById("addBtn").innerText = "+"; }
        else { facturi.push({nume: n.value.trim(), suma: parseFloat(s.value)||0, status: false}); }
        n.value = ""; s.value = ""; render();
    }

    function pregatesteEditare(i) {
        editIndex = i;
        document.getElementById("newFactura").value = facturi[i].nume;
        document.getElementById("newSuma").value = facturi[i].suma;
        document.getElementById("addBtn").innerText = "‚úì";
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function toggle(i) { facturi[i].status = !facturi[i].status; render(); }
    function sterge(i) { Swal.fire({ title: '»òtergi?', text: facturi[i].nume, icon: 'warning', showCancelButton: true }).then((r) => { if(r.isConfirmed) { facturi.splice(i, 1); render(); } }); }
    function resetareLocala() { Swal.fire({ title: 'Resetare?', icon: 'error', showCancelButton: true }).then((r) => { if(r.isConfirmed) { localStorage.clear(); location.reload(); } }); }

    function trimiteDate() {
        Swal.fire({ title: 'Salvare...', didOpen: () => Swal.showLoading() });
        fetch(scriptURL, { method: "POST", mode: "no-cors", body: JSON.stringify(facturi) })
        .then(() => Swal.fire({ icon: 'success', title: 'Salvat!', timer: 1000, showConfirmButton: false }));
    }

    window.onload = () => {
        document.getElementById('headerMonth').innerText = new Date().toLocaleString('ro-RO', { month: 'long', year: 'numeric' });
        incarcaDate();
    };
</script>
</body>
</html>
